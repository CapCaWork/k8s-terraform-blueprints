apiVersion: karpenter.k8s.aws/v1
kind: EC2NodeClass
metadata:
  name: default
spec:
  # Required, resolves a default ami and userdata
  amiFamily: AL2
  role: "karpenter-{{ .Values.karpenter.settings.clusterName }}" 
  # Required, discovers subnets to attach to instances
  subnetSelectorTerms:
    - tags:
        karpenter.sh/discovery: {{ .Values.karpenter.settings.clusterName }}
  
  # Required, discovers security groups to attach to instances
  securityGroupSelectorTerms:
    - tags:
        karpenter.sh/discovery: {{ .Values.karpenter.settings.clusterName }}

  amiSelectorTerms:
    - id: {{ .Values.karpenter.settings.amiSelector.amd }} #"ami-049e49d359c8505cc"

  tags:
    Name: "{{ .Values.karpenter.settings.clusterName }}-Karpenter-Instance"


